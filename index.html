<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Observações - C.E. Prof. William Madi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
</head>
<body class="bg-[#1a237e] text-white font-sans min-h-screen">
    <div id="loading-screen" class="flex flex-col items-center justify-center min-h-screen">
        <i data-lucide="refresh-cw" class="w-10 h-10 animate-spin text-blue-400 mb-4"></i>
        <p class="text-xl">Sincronizando cronograma...</p>
    </div>

    <div id="app-content" class="hidden max-w-4xl mx-auto p-4 md:p-6 pb-20">
        <div class="flex flex-col gap-6 mb-8">
            <div class="flex justify-between items-start">
                <div class="flex flex-col gap-1">
                    <h1 class="text-2xl md:text-3xl font-bold flex items-center gap-3">
                        <i data-lucide="calendar" class="text-blue-400"></i> Painel de Observações
                    </h1>
                    <p class="text-blue-200/80">C.E. Prof. William Madi - Trimestre <span class="ml-2 px-2 py-0.5 bg-blue-500/20 rounded text-xs border border-blue-400/30">Salvo na nuvem</span></p>
                </div>
                <div class="text-right">
                    <div id="prog-pct" class="text-3xl md:text-4xl font-black text-blue-400">0%</div>
                    <div class="text-[10px] uppercase tracking-widest text-blue-200/50 font-bold">Concluído</div>
                </div>
            </div>
            <div class="w-full bg-blue-900/50 rounded-full h-1.5 overflow-hidden border border-white/5">
                <div id="prog-bar" class="bg-blue-400 h-full transition-all duration-700 shadow-[0_0_10px_rgba(96,165,250,0.5)]" style="width: 0%"></div>
            </div>
        </div>

        <div class="grid grid-cols-3 gap-4 mb-8">
            <div class="bg-white/5 border border-white/10 p-4 rounded-2xl">
                <div class="text-[10px] font-bold text-blue-200/40 uppercase mb-1">Total</div>
                <div id="stat-total" class="text-2xl font-bold italic">48</div>
            </div>
            <div id="stat-done-card" class="bg-green-500/10 border border-green-500/20 p-4 rounded-2xl">
                <div class="text-[10px] font-bold text-green-400/60 uppercase mb-1 text-center">Realizadas</div>
                <div id="stat-done" class="text-2xl font-bold text-green-400 text-center">0</div>
            </div>
            <div class="bg-orange-500/10 border border-orange-500/20 p-4 rounded-2xl">
                <div class="text-[10px] font-bold text-orange-400/60 uppercase mb-1 text-right">Pendentes</div>
                <div id="stat-pending" class="text-2xl font-bold text-orange-400 text-right font-mono">48</div>
            </div>
        </div>

        <div id="weeks-container" class="space-y-4"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD9sYzRQK0yJtTK9aY_ugev6FiTYtlsZEI",
            authDomain: "meu-app-escolar-568ef.firebaseapp.com",
            projectId: "meu-app-escolar-568ef",
            storageBucket: "meu-app-escolar-568ef.firebasestorage.app",
            messagingSenderId: "251193660931",
            appId: "1:251193660931:web:8fd8faa0598dc1a36aa036"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        // Dados das 12 semanas reduzidos para o exemplo (inclua todos os 48 itens aqui)
        const initialSchedule = [
            { id: 1, title: "Semana 1", items: [
                { id: '1-1', dia: 'Segunda', prof: 'Tereza', disc: 'Matemática', turma: '3ºA', feito: false },
                { id: '1-2', dia: 'Quarta', prof: 'Alessandra', disc: 'Física', turma: '3ºA', feito: false },
                { id: '1-3', dia: 'Quinta', prof: 'Lucas', disc: 'Robótica', turma: '8ºA', feito: false },
                { id: '1-4', dia: 'Sexta', prof: 'Miguel', disc: 'Pensam. Lógico', turma: '6ºA', feito: false }
            ]}
            // Adicione as outras semanas aqui seguindo o padrão
        ];

        let currentExpanded = 1;

        function updateUI(schedule) {
            const container = document.getElementById('weeks-container');
            let total = 0, done = 0;

            container.innerHTML = schedule.map(week => {
                const weekDone = week.items.filter(i => i.feito).length;
                total += week.items.length;
                done += weekDone;

                return `
                <div class="bg-white/5 border border-white/10 rounded-2xl overflow-hidden transition-all duration-300">
                    <div onclick="toggleExpand(${week.id})" class="p-5 flex items-center justify-between cursor-pointer hover:bg-white/[0.08] active:scale-[0.99] transition-transform">
                        <div class="flex items-center gap-4">
                            <div class="w-1.5 h-1.5 rounded-full ${weekDone === week.items.length ? 'bg-green-400 shadow-[0_0_8px_#4ade80]' : 'bg-blue-400 shadow-[0_0_8px_#60a5fa]'}"></div>
                            <div>
                                <h3 class="font-bold text-lg">${week.title}</h3>
                                <p class="text-xs text-blue-200/40 font-medium">${weekDone}/${week.items.length} observações finalizadas</p>
                            </div>
                        </div>
                        <i data-lucide="${currentExpanded === week.id ? 'chevron-up' : 'chevron-down'}" class="w-5 h-5 text-white/20"></i>
                    </div>
                    <div class="${currentExpanded === week.id ? 'block' : 'hidden'} border-t border-white/5 p-3 space-y-2 bg-black/20">
                        ${week.items.map(item => `
                            <div onclick="toggleItem(${week.id}, '${item.id}')" class="flex items-center justify-between p-4 rounded-xl cursor-pointer transition-all border ${item.feito ? 'bg-green-500/10 border-green-500/30' : 'bg-white/5 border-transparent hover:border-white/10'}">
                                <div class="flex items-center gap-4">
                                    <i data-lucide="${item.feito ? 'check-circle' : 'circle'}" class="w-6 h-6 ${item.feito ? 'text-green-400' : 'text-white/10'}"></i>
                                    <div>
                                        <p class="font-bold ${item.feito ? 'text-green-400/50 line-through' : 'text-white'}">${item.prof}</p>
                                        <p class="text-[10px] text-blue-200/40 font-bold uppercase tracking-wider">${item.dia} • ${item.disc} • ${item.turma}</p>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>`;
            }).join('');

            const progress = Math.round((done / total) * 100);
            document.getElementById('prog-pct').innerText = progress + '%';
            document.getElementById('prog-bar').style.width = progress + '%';
            document.getElementById('stat-total').innerText = total;
            document.getElementById('stat-done').innerText = done;
            document.getElementById('stat-pending').innerText = total - done;
            lucide.createIcons();
        }

        window.toggleExpand = (id) => {
            currentExpanded = currentExpanded === id ? null : id;
            db.ref('schedule').once('value', s => updateUI(s.val()));
        };

        window.toggleItem = (weekId, itemId) => {
            db.ref('schedule').once('value', snapshot => {
                const data = snapshot.val();
                const week = data.find(w => w.id === weekId);
                const item = week.items.find(i => i.id === itemId);
                item.feito = !item.feito;
                db.ref('schedule').set(data);
            });
        };

        auth.signInAnonymously().then(() => {
            db.ref('schedule').on('value', snapshot => {
                const data = snapshot.val();
                if (!data) {
                    db.ref('schedule').set(initialSchedule);
                } else {
                    document.getElementById('loading-screen').classList.add('hidden');
                    document.getElementById('app-content').classList.remove('hidden');
                    updateUI(data);
                }
            });
        });
    </script>
</body>
</html>
