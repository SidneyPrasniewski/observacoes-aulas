<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Observações - C.E. Prof. William Madi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
</head>
<body class="bg-gray-50 text-slate-800 font-sans">
    <div id="loading-screen" class="min-h-screen bg-gray-50 flex items-center justify-center text-blue-800">
        <div class="flex flex-col items-center gap-2">
            <i data-lucide="refresh-cw" class="w-8 h-8 animate-spin"></i>
            <p>Sincronizando cronograma...</p>
        </div>
    </div>

    <div id="app-content" class="hidden">
        <div class="bg-blue-900 text-white p-6 sticky top-0 z-10 shadow-lg">
            <div class="max-w-4xl mx-auto">
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <h1 class="text-2xl font-bold flex items-center gap-2">
                            <i data-lucide="calendar" class="w-6 h-6"></i> Painel de Observações
                        </h1>
                        <div class="flex items-center gap-2 text-blue-200 text-sm mt-1">
                            <span>C.E. Prof. William Madi - Trimestre</span>
                            <span class="flex items-center gap-1 bg-blue-800 px-2 py-0.5 rounded text-xs border border-blue-700">
                                <i data-lucide="cloud" class="w-3 h-3"></i> Salvo na nuvem
                            </span>
                        </div>
                    </div>
                    <div class="text-right">
                        <div id="progress-percent" class="text-3xl font-bold">0%</div>
                        <div class="text-xs text-blue-200">Concluído</div>
                    </div>
                </div>
                <div class="w-full bg-blue-950 rounded-full h-2.5">
                    <div id="progress-bar" class="bg-green-400 h-2.5 rounded-full transition-all duration-500 relative" style="width: 0%">
                        <div class="absolute right-0 top-1/2 -translate-y-1/2 w-2 h-2 bg-white rounded-full shadow"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="max-w-4xl mx-auto p-4 grid grid-cols-2 md:grid-cols-3 gap-4 mb-2">
            <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200">
                <div class="text-gray-500 text-xs font-bold uppercase mb-1">Total</div>
                <div id="stat-total" class="text-2xl font-bold text-slate-700">0</div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200">
                <div class="text-gray-500 text-xs font-bold uppercase mb-1">Feitas</div>
                <div id="stat-done" class="text-2xl font-bold text-green-600">0</div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 col-span-2 md:col-span-1">
                <div class="text-gray-500 text-xs font-bold uppercase mb-1">Pendentes</div>
                <div id="stat-pending" class="text-2xl font-bold text-orange-600">0</div>
            </div>
        </div>

        <div id="weeks-container" class="max-w-4xl mx-auto p-4 space-y-4"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD9sYzRQK0yJtTK9aY_ugev6FiTYtlsZEI",
            authDomain: "meu-app-escolar-568ef.firebaseapp.com",
            projectId: "meu-app-escolar-568ef",
            storageBucket: "meu-app-escolar-568ef.firebasestorage.app",
            messagingSenderId: "251193660931",
            appId: "1:251193660931:web:8fd8faa0598dc1a36aa036"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        const initialSchedule = [
            { id: 1, title: "Semana 1", items: [
                { id: '1-1', dia: 'Segunda', periodo: 'Tarde', prof: 'Tereza', disc: 'Matemática', turma: '3ºA', feito: false },
                { id: '1-2', dia: 'Quarta', periodo: 'Tarde', prof: 'Alessandra', disc: 'Física', turma: '3ºA', feito: false },
                { id: '1-3', dia: 'Quinta', periodo: 'Manhã', prof: 'Lucas', disc: 'Robótica', turma: '8ºA', feito: false },
                { id: '1-4', dia: 'Sexta', periodo: 'Tarde', prof: 'Miguel', disc: 'Pensam. Lógico', turma: '6ºA', feito: false }
            ]},
            { id: 2, title: "Semana 2", items: [
                { id: '2-1', dia: 'Segunda', periodo: 'Tarde', prof: 'Michele', disc: 'Empreended.', turma: '9ºA', feito: false },
                { id: '2-2', dia: 'Quarta', periodo: 'Tarde', prof: 'Cristiane P.', disc: 'Matemática', turma: '9ºA', feito: false },
                { id: '2-3', dia: 'Quinta', periodo: 'Tarde', prof: 'Keila', disc: 'Matemática', turma: '7ºB', feito: false },
                { id: '2-4', dia: 'Sexta', periodo: 'Tarde', prof: 'Cris Luz / Nilton', disc: 'Rec. Aprendiz.', turma: '9ºA', feito: false }
            ]},
            { id: 3, title: "Semana 3", items: [
                { id: '3-1', dia: 'Segunda', periodo: 'Tarde', prof: 'Tereza', disc: 'Matemática', turma: '3ºA', feito: false },
                { id: '3-2', dia: 'Quarta', periodo: 'Tarde', prof: 'Cristiane Luz', disc: 'Ed. Financeira', turma: '1ºA', feito: false },
                { id: '3-3', dia: 'Quinta', periodo: 'Manhã', prof: 'Lucas', disc: 'Robótica', turma: '8ºA', feito: false },
                { id: '3-4', dia: 'Quinta', periodo: 'Tarde', prof: 'Taina', disc: 'Matemática', turma: '2ºA', feito: false }
            ]},
            { id: 4, title: "Semana 4", items: [
                { id: '4-1', dia: 'Segunda', periodo: 'Tarde', prof: 'Michele', disc: 'Empreended.', turma: '9ºA', feito: false },
                { id: '4-2', dia: 'Quarta', periodo: 'Tarde', prof: 'Alessandra', disc: 'Física', turma: '3ºA', feito: false },
                { id: '4-3', dia: 'Quinta', periodo: 'Tarde', prof: 'Keila', disc: 'Matemática', turma: '7ºB', feito: false },
                { id: '4-4', dia: 'Sexta', periodo: 'Tarde', prof: 'Miguel', disc: 'Pensam. Lógico', turma: '6ºA', feito: false }
            ]},
            { id: 5, title: "Semana 5", items: [
                { id: '5-1', dia: 'Segunda', periodo: 'Tarde', prof: 'Cristiane Luz', disc: 'Ed. Financeira', turma: '7ºA', feito: false },
                { id: '5-2', dia: 'Quarta', periodo: 'Tarde', prof: 'Cristiane P.', disc: 'Matemática', turma: '9ºA', feito: false },
                { id: '5-3', dia: 'Quinta', periodo: 'Tarde', prof: 'Taina', disc: 'Matemática', turma: '2ºA', feito: false },
                { id: '5-4', dia: 'Sexta', periodo: 'Tarde', prof: 'Cris Luz / Nilton', disc: 'Rec. Aprendiz.', turma: '9ºA', feito: false }
            ]},
            { id: 6, title: "Semana 6", items: [
                { id: '6-1', dia: 'Segunda', periodo: 'Tarde', prof: 'Tereza', disc: 'Matemática', turma: '3ºA', feito: false },
                { id: '6-2', dia: 'Quarta', periodo: 'Tarde', prof: 'Alessandra', disc: 'Física', turma: '3ºA', feito: false },
                { id: '6-3', dia: 'Quinta', periodo: 'Manhã', prof: 'Lucas', disc: 'Robótica', turma: '8ºA', feito: false },
                { id: '6-4', dia: 'Sexta', periodo: 'Tarde', prof: 'Miguel', disc: 'Pensam. Lógico', turma: '6ºA', feito: false }
            ]},
            { id: 7, title: "Semana 7", items: [
                { id: '7-1', dia: 'Segunda', periodo: 'Tarde', prof: 'Michele', disc: 'Empreended.', turma: '9ºA', feito: false },
                { id: '7-2', dia: 'Quarta', periodo: 'Tarde', prof: 'Cristiane P.', disc: 'Matemática', turma: '9ºA', feito: false },
                { id: '7-3', dia: 'Quinta', periodo: 'Tarde', prof: 'Keila', disc: 'Matemática', turma: '7ºB', feito: false },
                { id: '7-4', dia: 'Sexta', periodo: 'Tarde', prof: 'Cris Luz / Nilton', disc: 'Rec. Aprendiz.', turma: '9ºA', feito: false }
            ]},
            { id: 8, title: "Semana 8", items: [
                { id: '8-1', dia: 'Segunda', periodo: 'Tarde', prof: 'Tereza', disc: 'Matemática', turma: '3ºA', feito: false },
                { id: '8-2', dia: 'Quarta', periodo: 'Tarde', prof: 'Cristiane Luz', disc: 'Ed. Financeira', turma: '1ºA', feito: false },
                { id: '8-3', dia: 'Quinta', periodo: 'Manhã', prof: 'Lucas', disc: 'Robótica', turma: '8ºA', feito: false },
                { id: '8-4', dia: 'Quinta', periodo: 'Tarde', prof: 'Taina', disc: 'Matemática', turma: '2ºA', feito: false }
            ]},
            { id: 9, title: "Semana 9", items: [
                { id: '9-1', dia: 'Segunda', periodo: 'Tarde', prof: 'Michele', disc: 'Empreended.', turma: '9ºA', feito: false },
                { id: '9-2', dia: 'Quarta', periodo: 'Tarde', prof: 'Alessandra', disc: 'Física', turma: '3ºA', feito: false },
                { id: '9-3', dia: 'Quinta', periodo: 'Tarde', prof: 'Keila', disc: 'Matemática', turma: '7ºB', feito: false },
                { id: '9-4', dia: 'Sexta', periodo: 'Tarde', prof: 'Miguel', disc: 'Pensam. Lógico', turma: '6ºA', feito: false }
            ]},
            { id: 10, title: "Semana 10", items: [
                { id: '10-1', dia: 'Segunda', periodo: 'Tarde', prof: 'Cristiane Luz', disc: 'Ed. Financeira', turma: '7ºA', feito: false },
                { id: '10-2', dia: 'Quarta', periodo: 'Tarde', prof: 'Cristiane P.', disc: 'Matemática', turma: '9ºA', feito: false },
                { id: '10-3', dia: 'Quinta', periodo: 'Tarde', prof: 'Taina', disc: 'Matemática', turma: '2ºA', feito: false },
                { id: '10-4', dia: 'Sexta', periodo: 'Tarde', prof: 'Cris Luz / Nilton', disc: 'Rec. Aprendiz.', turma: '9ºA', feito: false }
            ]},
            { id: 11, title: "Semana 11", items: [
                { id: '11-1', dia: 'Segunda', periodo: 'Tarde', prof: 'Tereza', disc: 'Matemática', turma: '3ºA', feito: false },
                { id: '11-2', dia: 'Quarta', periodo: 'Tarde', prof: 'Alessandra', disc: 'Física', turma: '3ºA', feito: false },
                { id: '11-3', dia: 'Quinta', periodo: 'Manhã', prof: 'Lucas', disc: 'Robótica', turma: '8ºA', feito: false },
                { id: '11-4', dia: 'Sexta', periodo: 'Tarde', prof: 'Miguel', disc: 'Pensam. Lógico', turma: '6ºA', feito: false }
            ]},
            { id: 12, title: "Semana 12", items: [
                { id: '12-1', dia: 'Segunda', periodo: 'Tarde', prof: 'Michele', disc: 'Empreended.', turma: '9ºA', feito: false },
                { id: '12-2', dia: 'Quarta', periodo: 'Tarde', prof: 'Cristiane P.', disc: 'Matemática', turma: '9ºA', feito: false },
                { id: '12-3', dia: 'Quinta', periodo: 'Tarde', prof: 'Keila', disc: 'Matemática', turma: '7ºB', feito: false },
                { id: '12-4', dia: 'Sexta', periodo: 'Tarde', prof: 'Cris Luz / Nilton', disc: 'Rec. Aprendiz.', turma: '9ºA', feito: false }
            ]}
        ];

        let currentExpanded = 1;

        function updateUI(schedule) {
            const container = document.getElementById('weeks-container');
            let total = 0, done = 0;

            container.innerHTML = schedule.map(week => {
                const weekDone = week.items.filter(i => i.feito).length;
                const isAllDone = weekDone === week.items.length;
                total += week.items.length;
                done += weekDone;

                return `
                <div class="bg-white rounded-lg shadow-sm border transition-all ${isAllDone ? 'border-green-200 bg-green-50' : 'border-gray-200'}">
                    <div onclick="toggleExpand(${week.id})" class="p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50">
                        <div class="flex items-center gap-3">
                            <div class="w-2 h-2 rounded-full ${isAllDone ? 'bg-green-500' : 'bg-blue-600'}"></div>
                            <div>
                                <h3 class="font-bold ${isAllDone ? 'text-green-800' : 'text-slate-800'}">${week.title}</h3>
                                <div class="text-xs text-gray-500">${weekDone}/${week.items.length} observações</div>
                            </div>
                        </div>
                        <i data-lucide="${currentExpanded === week.id ? 'chevron-up' : 'chevron-down'}" class="w-5 h-5 text-gray-400"></i>
                    </div>
                    <div class="${currentExpanded === week.id ? 'block' : 'hidden'} border-t border-gray-100 p-2">
                        ${week.items.map(item => `
                            <div onclick="toggleItem(${week.id}, '${item.id}')" class="flex items-center justify-between p-3 mb-2 rounded cursor-pointer transition-colors ${item.feito ? 'bg-green-100' : 'bg-white border hover:bg-gray-50'}">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="${item.feito ? 'check-circle' : 'circle'}" class="w-6 h-6 ${item.feito ? 'text-green-600' : 'text-gray-300'}"></i>
                                    <div>
                                        <p class="font-medium ${item.feito ? 'text-green-800 line-through' : 'text-slate-800'}">${item.prof}</p>
                                        <p class="text-xs text-gray-500">${item.dia} • ${item.disc} • ${item.turma}</p>
                                    </div>
                                </div>
                                <div class="text-xs px-2 py-1 rounded ${item.feito ? 'bg-green-200 text-green-800' : 'bg-gray-100 text-gray-600'}">${item.periodo}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>`;
            }).join('');

            const progress = Math.round((done / total) * 100);
            document.getElementById('progress-percent').innerText = progress + '%';
            document.getElementById('progress-bar').style.width = progress + '%';
            document.getElementById('stat-total').innerText = total;
            document.getElementById('stat-done').innerText = done;
            document.getElementById('stat-pending').innerText = total - done;
            lucide.createIcons();
        }

        window.toggleExpand = (id) => {
            currentExpanded = currentExpanded === id ? null : id;
            db.ref('schedule').once('value', s => updateUI(s.val()));
        };

        window.toggleItem = (weekId, itemId) => {
            db.ref('schedule').once('value', snapshot => {
                const data = snapshot.val();
                const week = data.find(w => w.id === weekId);
                const item = week.items.find(i => i.id === itemId);
                item.feito = !item.feito;
                db.ref('schedule').set(data);
            });
        };

        auth.signInAnonymously().then(() => {
            db.ref('schedule').on('value', snapshot => {
                const data = snapshot.val();
                if (!data) {
                    db.ref('schedule').set(initialSchedule);
                } else {
                    document.getElementById('loading-screen').classList.add('hidden');
                    document.getElementById('app-content').classList.remove('hidden');
                    updateUI(data);
                }
            });
        });
    </script>
</body>
</html>
