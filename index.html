<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Observações - C.E. Prof. William Madi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
</head>
<body class="bg-[#111827] text-white font-sans min-h-screen">
    <div id="loading-screen" class="flex flex-col items-center justify-center min-h-screen">
        <i data-lucide="refresh-cw" class="w-10 h-10 animate-spin text-blue-500 mb-4"></i>
        <p class="text-xl font-medium">Sincronizando cronograma...</p>
    </div>

    <div id="app-content" class="hidden max-w-5xl mx-auto p-4 md:p-8">
        <div class="flex flex-col gap-6 mb-10">
            <div class="flex justify-between items-start">
                <div class="space-y-1">
                    <h1 class="text-3xl font-bold flex items-center gap-3">
                        <i data-lucide="calendar" class="text-blue-500"></i> Painel de Observações
                    </h1>
                    <p class="text-gray-400 text-sm">C.E. Prof. William Madi - Trimestre <span class="ml-2 px-2 py-0.5 bg-blue-500/10 rounded text-blue-400 text-[10px] border border-blue-500/20 uppercase">Salvo na nuvem</span></p>
                </div>
                <div class="text-right">
                    <div id="prog-pct" class="text-4xl font-black text-blue-500">0%</div>
                    <div class="text-[10px] uppercase tracking-tighter text-gray-500 font-bold">Concluído</div>
                </div>
            </div>
            <div class="w-full bg-gray-800 rounded-full h-2 overflow-hidden border border-white/5 shadow-inner">
                <div id="prog-bar" class="bg-blue-500 h-full transition-all duration-1000 shadow-[0_0_15px_rgba(59,130,246,0.5)]" style="width: 0%"></div>
            </div>
        </div>

        <div class="grid grid-cols-3 gap-4 mb-10">
            <div class="bg-gray-800/40 border border-white/5 p-5 rounded-2xl">
                <div class="text-[10px] font-bold text-gray-500 uppercase mb-1">Total Observações</div>
                <div id="stat-total" class="text-3xl font-bold">48</div>
            </div>
            <div class="bg-green-500/5 border border-green-500/10 p-5 rounded-2xl text-center">
                <div class="text-[10px] font-bold text-green-500/60 uppercase mb-1">Realizadas</div>
                <div id="stat-done" class="text-3xl font-bold text-green-500">0</div>
            </div>
            <div class="bg-orange-500/5 border border-orange-500/10 p-5 rounded-2xl text-right">
                <div class="text-[10px] font-bold text-orange-500/60 uppercase mb-1">Pendentes</div>
                <div id="stat-pending" class="text-3xl font-bold text-orange-500">48</div>
            </div>
        </div>

        <div id="weeks-container" class="space-y-4 pb-20"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD9sYzRQK0yJtTK9aY_ugev6FiTYtlsZEI",
            authDomain: "meu-app-escolar-568ef.firebaseapp.com",
            projectId: "meu-app-escolar-568ef",
            storageBucket: "meu-app-escolar-568ef.firebasestorage.app",
            messagingSenderId: "251193660931",
            appId: "1:251193660931:web:8fd8faa0598dc1a36aa036"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        const initialSchedule = [
            { id: 1, title: "Semana 1", items: [
                { id: '1-1', dia: 'Segunda', prof: 'Tereza', disc: 'Matemática', turma: '3ºA', feito: false },
                { id: '1-2', dia: 'Quarta', prof: 'Alessandra', disc: 'Física', turma: '3ºA', feito: false },
                { id: '1-3', dia: 'Quinta', prof: 'Lucas', disc: 'Robótica', turma: '8ºA', feito: false },
                { id: '1-4', dia: 'Sexta', prof: 'Miguel', disc: 'Pensam. Lógico', turma: '6ºA', feito: false }
            ]},
            { id: 2, title: "Semana 2", items: [
                { id: '2-1', dia: 'Segunda', prof: 'Michele', disc: 'Empreended.', turma: '9ºA', feito: false },
                { id: '2-2', dia: 'Quarta', prof: 'Cristiane P.', disc: 'Matemática', turma: '9ºA', feito: false },
                { id: '2-3', dia: 'Quinta', prof: 'Keila', disc: 'Matemática', turma: '7ºB', feito: false },
                { id: '2-4', dia: 'Sexta', prof: 'Cris Luz / Nilton', disc: 'Rec. Aprendiz.', turma: '9ºA', feito: false }
            ]},
            { id: 3, title: "Semana 3", items: [
                { id: '3-1', dia: 'Segunda', prof: 'Tereza', disc: 'Matemática', turma: '3ºA', feito: false },
                { id: '3-2', dia: 'Quarta', prof: 'Cristiane Luz', disc: 'Ed. Financeira', turma: '1ºA', feito: false },
                { id: '3-3', dia: 'Quinta', prof: 'Lucas', disc: 'Robótica', turma: '8ºA', feito: false },
                { id: '3-4', dia: 'Quinta', prof: 'Taina', disc: 'Matemática', turma: '2ºA', feito: false }
            ]},
            { id: 4, title: "Semana 4", items: [
                { id: '4-1', dia: 'Segunda', prof: 'Michele', disc: 'Empreended.', turma: '9ºA', feito: false },
                { id: '4-2', dia: 'Quarta', prof: 'Alessandra', disc: 'Física', turma: '3ºA', feito: false },
                { id: '4-3', dia: 'Quinta', prof: 'Keila', disc: 'Matemática', turma: '7ºB', feito: false },
                { id: '4-4', dia: 'Sexta', prof: 'Miguel', disc: 'Pensam. Lógico', turma: '6ºA', feito: false }
            ]},
            { id: 5, title: "Semana 5", items: [
                { id: '5-1', dia: 'Segunda', prof: 'Cristiane Luz', disc: 'Ed. Financeira', turma: '7ºA', feito: false },
                { id: '5-2', dia: 'Quarta', prof: 'Cristiane P.', disc: 'Matemática', turma: '9ºA', feito: false },
                { id: '5-3', dia: 'Quinta', prof: 'Taina', disc: 'Matemática', turma: '2ºA', feito: false },
                { id: '5-4', dia: 'Sexta', prof: 'Cris Luz / Nilton', disc: 'Rec. Aprendiz.', turma: '9ºA', feito: false }
            ]},
            { id: 6, title: "Semana 6", items: [
                { id: '6-1', dia: 'Segunda', prof: 'Tereza', disc: 'Matemática', turma: '3ºA', feito: false },
                { id: '6-2', dia: 'Quarta', prof: 'Alessandra', disc: 'Física', turma: '3ºA', feito: false },
                { id: '6-3', dia: 'Quinta', prof: 'Lucas', disc: 'Robótica', turma: '8ºA', feito: false },
                { id: '6-4', dia: 'Sexta', prof: 'Miguel', disc: 'Pensam. Lógico', turma: '6ºA', feito: false }
            ]},
            { id: 7, title: "Semana 7", items: [
                { id: '7-1', dia: 'Segunda', prof: 'Michele', disc: 'Empreended.', turma: '9ºA', feito: false },
                { id: '7-2', dia: 'Quarta', prof: 'Cristiane P.', disc: 'Matemática', turma: '9ºA', feito: false },
                { id: '7-3', dia: 'Quinta', prof: 'Keila', disc: 'Matemática', turma: '7ºB', feito: false },
                { id: '7-4', dia: 'Sexta', prof: 'Cris Luz / Nilton', disc: 'Rec. Aprendiz.', turma: '9ºA', feito: false }
            ]},
            { id: 8, title: "Semana 8", items: [
                { id: '8-1', dia: 'Segunda', prof: 'Tereza', disc: 'Matemática', turma: '3ºA', feito: false },
                { id: '8-2', dia: 'Quarta', prof: 'Cristiane Luz', disc: 'Ed. Financeira', turma: '1ºA', feito: false },
                { id: '8-3', dia: 'Quinta', prof: 'Lucas', disc: 'Robótica', turma: '8ºA', feito: false },
                { id: '8-4', dia: 'Quinta', prof: 'Taina', disc: 'Matemática', turma: '2ºA', feito: false }
            ]},
            { id: 9, title: "Semana 9", items: [
                { id: '9-1', dia: 'Segunda', prof: 'Michele', disc: 'Empreended.', turma: '9ºA', feito: false },
                { id: '9-2', dia: 'Quarta', prof: 'Alessandra', disc: 'Física', turma: '3ºA', feito: false },
                { id: '9-3', dia: 'Quinta', prof: 'Keila', disc: 'Matemática', turma: '7ºB', feito: false },
                { id: '9-4', dia: 'Sexta', prof: 'Miguel', disc: 'Pensam. Lógico', turma: '6ºA', feito: false }
            ]},
            { id: 10, title: "Semana 10", items: [
                { id: '10-1', dia: 'Segunda', prof: 'Cristiane Luz', disc: 'Ed. Financeira', turma: '7ºA', feito: false },
                { id: '10-2', dia: 'Quarta', prof: 'Cristiane P.', disc: 'Matemática', turma: '9ºA', feito: false },
                { id: '10-3', dia: 'Quinta', prof: 'Taina', disc: 'Matemática', turma: '2ºA', feito: false },
                { id: '10-4', dia: 'Sexta', prof: 'Cris Luz / Nilton', disc: 'Rec. Aprendiz.', turma: '9ºA', feito: false }
            ]},
            { id: 11, title: "Semana 11", items: [
                { id: '11-1', dia: 'Segunda', prof: 'Tereza', disc: 'Matemática', turma: '3ºA', feito: false },
                { id: '11-2', dia: 'Quarta', prof: 'Alessandra', disc: 'Física', turma: '3ºA', feito: false },
                { id: '11-3', dia: 'Quinta', prof: 'Lucas', disc: 'Robótica', turma: '8ºA', feito: false },
                { id: '11-4', dia: 'Sexta', prof: 'Miguel', disc: 'Pensam. Lógico', turma: '6ºA', feito: false }
            ]},
            { id: 12, title: "Semana 12", items: [
                { id: '12-1', dia: 'Segunda', prof: 'Michele', disc: 'Empreended.', turma: '9ºA', feito: false },
                { id: '12-2', dia: 'Quarta', prof: 'Cristiane P.', disc: 'Matemática', turma: '9ºA', feito: false },
                { id: '12-3', dia: 'Quinta', prof: 'Keila', disc: 'Matemática', turma: '7ºB', feito: false },
                { id: '12-4', dia: 'Sexta', prof: 'Cris Luz / Nilton', disc: 'Rec. Aprendiz.', turma: '9ºA', feito: false }
            ]}
        ];

        let expandedWeek = 1;

        function updateUI(schedule) {
            const container = document.getElementById('weeks-container');
            let total = 0, done = 0;

            container.innerHTML = schedule.map(week => {
                const weekDone = week.items.filter(i => i.feito).length;
                total += week.items.length;
                done += weekDone;

                return `
                <div class="bg-white/5 border border-white/10 rounded-2xl overflow-hidden transition-all">
                    <div onclick="toggleExpand(${week.id})" class="p-5 flex items-center justify-between cursor-pointer hover:bg-white/[0.08]">
                        <div class="flex items-center gap-4">
                            <div class="w-1.5 h-1.5 rounded-full ${weekDone === week.items.length ? 'bg-green-500 shadow-[0_0_8px_#22c55e]' : 'bg-blue-500 shadow-[0_0_8px_#3b82f6]'}"></div>
                            <div>
                                <h3 class="font-bold text-lg text-white">${week.title}</h3>
                                <p class="text-[10px] text-gray-500 font-bold uppercase tracking-widest">${weekDone}/${week.items.length} observações</p>
                            </div>
                        </div>
                        <i data-lucide="${expandedWeek === week.id ? 'chevron-up' : 'chevron-down'}" class="w-5 h-5 text-gray-600"></i>
                    </div>
                    <div class="${expandedWeek === week.id ? 'block' : 'hidden'} border-t border-white/5 p-3 space-y-2 bg-black/20">
                        ${week.items.map(item => `
                            <div onclick="toggleItem(${week.id}, '${item.id}')" class="flex items-center justify-between p-4 rounded-xl cursor-pointer transition-all border ${item.feito ? 'bg-green-500/10 border-green-500/30' : 'bg-white/5 border-transparent hover:border-white/10'}">
                                <div class="flex items-center gap-4">
                                    <i data-lucide="${item.feito ? 'check-circle' : 'circle'}" class="w-6 h-6 ${item.feito ? 'text-green-500' : 'text-gray-700'}"></i>
                                    <div>
                                        <p class="font-bold ${item.feito ? 'text-green-500/50 line-through' : 'text-white'}">${item.prof}</p>
                                        <p class="text-[10px] text-gray-500 font-bold uppercase tracking-wider">${item.dia} • ${item.disc} • ${item.turma}</p>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>`;
            }).join('');

            const progress = Math.round((done / total) * 100);
            document.getElementById('prog-pct').innerText = progress + '%';
            document.getElementById('prog-bar').style.width = progress + '%';
            document.getElementById('stat-total').innerText = total;
            document.getElementById('stat-done').innerText = done;
            document.getElementById('stat-pending').innerText = total - done;
            lucide.createIcons();
        }

        window.toggleExpand = (id) => {
            expandedWeek = expandedWeek === id ? null : id;
            db.ref('schedule').once('value', s => updateUI(s.val()));
        };

        window.toggleItem = (weekId, itemId) => {
            db.ref('schedule').once('value', snapshot => {
                const data = snapshot.val() || initialSchedule;
                const week = data.find(w => w.id === weekId);
                const item = week.items.find(i => i.id === itemId);
                item.feito = !item.feito;
                db.ref('schedule').set(data);
            });
        };

        auth.signInAnonymously().then(() => {
            db.ref('schedule').on('value', snapshot => {
                const data = snapshot.val();
                if (!data) {
                    db.ref('schedule').set(initialSchedule);
                } else {
                    document.getElementById('loading-screen').classList.add('hidden');
                    document.getElementById('app-content').classList.remove('hidden');
                    updateUI(data);
                }
            });
        });
    </script>
</body>
</html>
